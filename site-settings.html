<head>
  <link rel="stylesheet" href="css/right-click-menu.css" media="all">
  <link rel="stylesheet" href="css/buttons-and-menus.css" media="all">
  <link rel="stylesheet" href="css/panels.css" media="all">

</head>


<body class="body">
  <aside class="aside">

    <div class="panel top">
      <button disabled class="b-1" id="last-action-time"
        style="color: black;z-index:1; position: absolute;top: 50%;left: 50%; transform: translate(-50%, -50%);">0.0</button>
    </div>

    <div class="panel left" style="margin-top: 10px;">
        <a href="https://webdev983.github.io/templatesv3/files"><button class="b-1">📂</button></a>
    </div>
  
    </aside>
    <main class="main">

      <div style="margin: 10px;">
        <a href="https://webdev983.github.io/templatesv3/sites">
          <button class="b-4" style="margin-right: 5px;"><label class="l-1">🌐</label>
            <label class="l-2">Sites</label></button>  
          </a>

          <a href="https://webdev983.github.io/templatesv3/orders">
            <button class="b-4" style="margin-right: 5px;"><label class="l-1">🛍️</label>
              <label class="l-2">Orders</label></button>  
            </a>
        </div>

      <div class="panel horizontal-menu">
      <label class="l-1" style="margin-left: 40px; user-select: none; margin-right: 5px;">🌐</label><label class="l-1 b-dark-blue" id="site-name-value">-</label>
        </div>

        <label class="l-1 b-dark-blue" style=" margin-left: 30px; font-weight: 800;">AWS</label>

          <ul class="list-1 hide-bullets" id="aws-creds" style="margin-left: 30px;">
            <li><label class="l-3" style="user-select: none; margin-right: 5px;">🆔</label><label class="l-3" id="aws-id"
                ondblclick="onDoubleClick(event,'access_key')">-</label></li>
            <li><label class="l-3" style="user-select: none; margin-right: 5px;">🔑</label><label class="l-3" id="aws-secret"
                ondblclick="onDoubleClick(event,'secret_key')">-</label></td>
            </li>
            <li><label class="l-3" style="user-select: none; margin-right: 5px;">🌍</label><label class="l-3"
                id="aws-bucket-region" ondblclick="onDoubleClick(event,'region')">-</label></td>
            </li>
            <li><label class="l-3" style="user-select: none; margin-right: 5px;">🪣</label><label class="l-3"
                id="s3-bucket-name" ondblclick="onDoubleClick(event,'bucket')">-</label>
            </li>
          </ul>


          <label class="l-1 b-dark-blue" style="font-style: italic; margin-left: 30px; font-weight: 800;">PP</label>
          <ul class="list-1 hide-bullets" id="pp-creds" style="margin-left: 30px;">
            <select class="select-1" style="margin-bottom: 5px;">
              <option id="env-sandbox">🏖️ Sandbox</option>
              <option id="env-live">🧑‍💼 Live</option>
            </select>

      <li><label class="l-3" style="user-select: none; margin-right: 5px;">🆔</label><label class="l-3" id="pp-id">-</label></li>
      <li><label class="l-3" style="user-select: none; margin-right: 5px;">🔑</label><label class="l-3" id="pp-secret">-</label></li>
      <li><label class="l-3" style="user-select: none; margin-right: 5px;"> 🌐</label><label class="l-3" id="pp-domain">-</label></li>
      <li><label class="l-3" style="user-select: none; margin-right: 5px;">🛒</label><label class="l-3" id="pp-cart">-</label></li>
      <li><label class="l-3" style="user-select: none; margin-right: 5px;">✅</label><label class="l-3" id="pp-success">-</label></li>
      <li><label class="l-3" style="user-select: none; margin-right: 5px;">❌</label><label class="l-3" id="pp-fail">-</label></li>
          </ul>
    </main>

  
</div>
<script>
  const urlSearchParams = new URLSearchParams(window.location.search);
  const site = urlSearchParams.get('site');
  let response 

  function onDoubleClick(e, name) {
    var target = e.target;

    // Prevent the default double-click behavior
    e.preventDefault();

    // Set the 'contenteditable' attribute to 'true', making the element editable
    target.setAttribute('contenteditable', 'true');

    // Set focus on the editable element
    target.focus();

    let textContent = target.textContent;

    target.addEventListener('blur', function (blurEvent) {
      // Call the save function when the element loses focus

      if (textContent) {
        save(name, blurEvent.target.textContent);
      }

      // Remove the 'contenteditable' attribute after blur
      target.removeAttribute('contenteditable');
    });
  }


  const save = async (name, text) => {
    // Create a new object to only send the updated field to the server
    response[name] = text
    console.log(name + text)
    console.log(JSON.stringify(response))

    const res1 = await fetch('https://5jfh1fonoh.execute-api.us-east-1.amazonaws.com/prod/templatesv2', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(response),
    });
    console.log(JSON.stringify(await res1.json()))
  }
  const getSite = async () => {
    const res = await fetch(`https://5jfh1fonoh.execute-api.us-east-1.amazonaws.com/prod/templatesv2/${site}:creds`)
    response = await res.json()
    console.log('1'+JSON.stringify(response))
    if (!response) {
      response = {
        id: site,
        sk: 'creds',
        access_key: 'your_access_key',
        secret_key: 'your_secret_key',
        region: 'your_region',
        bucket: 'your_bucket'
      };
      await fetch('https://5jfh1fonoh.execute-api.us-east-1.amazonaws.com/prod/templatesv2', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(response),
      })
      
    }
    response.id= site
    // Get references to the HTML elements
    const awsIdElement = document.getElementById('aws-id');
    const awsSecretElement = document.getElementById('aws-secret');
    const awsRegionElement = document.getElementById('aws-bucket-region');
    const s3BucketNameElement = document.getElementById('s3-bucket-name');
    const siteName = document.getElementById('site-name-value');

    // Update the content of the HTML elements with the values from the 'response' object
    awsIdElement.textContent = response.access_key;
    awsSecretElement.textContent = response.secret_key;
    awsRegionElement.textContent = response.region;
    s3BucketNameElement.textContent = response.bucket;
    siteName.textContent = site;

  }
  document.addEventListener('DOMContentLoaded', getSite);
</script>