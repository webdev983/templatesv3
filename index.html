<!-- log format-->
<script>
  const format = 
  {
    "time": "41421412412412",
    "action": [
                "appendChild",
                "insertBefore",
                "innerHtml",
                "removeTag",
                "dublicateTag",
                "changeTag",
                "setAttribute",
                "removeAttribut",
                "innerText"
    ],
    "target-element": "uuid",
    "inserted-element": [
    [{ type: "tag", id: "uuid" }],
    [{ type: "tag", id: "uuid1" }, { type: "tag", id: "uuid2" }],
    [{ type: "component", id: "uuid" }]
    ],
     "inserted-code": "html code for inner html element",
     "tag-change": "div",

    "key": "class",
    "value": "cool-class",
    "text-content":"12421412412414141241",
    "option": "dublicate-with-parent"
};
    
</script>
<style>
  .menu button {
    border-radius: 5px;
    font-size: 1.2em;
  }
    </style>
  
<h2>generated page</h2>

<div id="generated-page">
  <component id="63ae5927-390f-4391-993d-b25ab09c8ada">
  </component>
</div>

<div id="content-grid"  style="display: grid; grid-template-columns: 100% 0%;">

<main>

<h2>builder</h2>
<div id="code-builder" style="position: relative;">
  <button id="aside-toggle" style="font-size: 1.5em; position: absolute; right: 0px; margin-top: -30px">&#8592;log</button>

  <div id="components-tree" style="position: relative">
    <div>
      <fieldset data-element="component-tree-tag">
        <legend>üí¨comment</legend>
        <button data-element="component-tree-show-hide-button">&#8594;</button>
        <button data-element="component-tree-tag-name-button">üß© accbuddy windows 11 product key page</button> 
        <button data-element="component-tree-css-button">üé®css(0)</button>
        <button data-element="component-tree-js-button">üíªjs(0)</button> 
        </fieldset>
    </div>
    
  </div>
  <div id="code-tree" style="position: relative;">
    <fieldset id="63ae5927-390f-4391-993d-b25ab09c8ada-tree" data-element="code-tree-tag">
      <legend>üí¨</legend>
      <input hidden type="checkbox" onchange="handleCheckboxChange(event)">
      <button data-element="code-tree-show-hide-button" onclick="toggleSubFields(event)">&#8594;</button>
      <button data-element="code-tree-tag-name-button">üè∑Ô∏ècomponent</button>
      <button data-element="code-tree-attributes-button">üîëAttributes</button>
      <button data-element="code-tree-text-content-button">üìÑText content</button> 
  </fieldset>
            
  </div>


<!--menus-->
<div hidden>

  <fieldset id="component-element" data-element="code-tree-tag">
    <legend>üí¨</legend>
    <input hidden type="checkbox" onchange="handleCheckboxChange(event)">
    <button data-element="code-tree-show-hide-button" onclick="toggleSubFields(event)">&#8594;</button>
    <button data-element="code-tree-tag-name-button" onclick="loader(event, handleComponentClick)">üè∑Ô∏ècomponent</button>
    <button data-element="code-tree-attributes-button">üîëAttributes</button>
    <button data-element="code-tree-text-content-button">üìÑText content</button> 
</fieldset>
<!--menu click component-->
<fieldset id="component-replace-menu" class="menu">
  <legend><button onclick = "cancel(event)" style="font-size: 0.9em;">‚ùå</button></legend>
  <span style="user-select:  none;">üìÇ </span><label id="current-page-path">universal/blablabla/blablabla/coolcss</label>
  <input id="current-page-path-input" width="auto" type="text" style="display:none;">
  <button id="current-page-path-edit" style="user-select:  none;">‚úèÔ∏è</button>
  <button hidden id="current-page-path-save">üíæ</button>
<div><span style="user-select:  none;">üÜî </span></span><label id="current-page-id">1414124-414221412-4124214124-412412</label></div>
<br>
<button>üîÑ replace component</button>

</fieldset>

<!-- menu select new path-->
       <fieldset id="code-tree-tag-attributes-form" class="menu"       >
        <legend><button onclick = "cancel(event)" style="font-size: 0.9em;">‚ùå</button></legend>
      <div>
          <select id="pathSelector" style="margin-top: 10px; min-width: 200px; font-size: 1.2em;">
              <option value="path0">‚¨áÔ∏è select</option>
              <option value="path1">‚¨ÖÔ∏è back</option>
              <option value="path2">‚û°Ô∏è universal</option>
              <option value="path3">‚û°Ô∏è orange</option>
          </select>
      </div>

        <table id="code-tree-tag-attributes-form-attributes-list" class="menu"        >
          <tr>
            <td><button>‚úÖselect</button></td>
            <td><span style="user-select:  none;">üìÇ</span><span data-value="path">universal/blablabla/blablabla/coolcss</span></td>
            <td><label>üß©</label></td>
          </tr>
          <tr>
            <tr>
              <td><button>‚úÖselect</button></td>
              <td><span style="user-select:  none;">üìÇ</span><span data-value="path">universal/blablabla/blablabla/coolcss</span></td>
              <td><label>üß©</label></td>
              </tr>
            <tr>
              <tr>
                <td><button>‚úÖselect</button></td>
                <td><span style="user-select:  none;">üìÇ</span><span data-value="path">universal/blablabla/blablabla/coolcss</span></td>
                <td><label>üß©</label></td>
                  </tr>
              <tr>
      
        </table>
</fieldset>



<!--menu click tag-->
<fieldset id="code-tree-click-tag" class="menu">
  <legend><button onclick = "cancel(event)" style="font-size: 0.9em;">‚ùå</button></legend>
            <button id="code-tree-click-tag-append-child" onclick = "append(event)">&#x1F476; append child</button>
            <button  id="code-tree-click-tag-insert-before" onclick = "insertB(event)">&#x2190; insert before</button>       
            <button  id="code-tree-click-tag-inner-html" onclick = "insertHtml(event)">üìÑ inner HTML</button>       
            <button  id="code-tree-click-tag-change-tag" onclick = "changeTag(event)">‚úèÔ∏è change tag</button>     
            <button  id="code-tree-click-tag-dublicate-tag" onclick = "duplicateTag(event)"> üìÑüìÑ dublicate tag</button>
            <button  id="code-tree-click-tag-remove-tag" onclick = "removeTag(event)">&#128465; remove tag</button>
</fieldset >

<!--menu enter comment-->
<span id="code-tree-tag-comment-form" class="menu">
  <input placeholder="üí¨ enter comment" type="text" id="code-tree-tag-comment-input">
  <button id="code-tree-tag-comment-save">üíæ</button>
  <button onclick = "cancel(event)" style="font-size: 0.9em;">‚ùå</button>
</span>

<!--menu add element-->
<fieldset id="code-tree-add-tag-step-1" class="menu">
    <legend><button onclick = "cancel(event)" style="font-size: 0.9em;">‚ùå</button></legend>
    <button id="code-tree-add-tag-choose-new" onclick = "addNew(event)"> üÜï choose new</button>
    <button  id="code-tree-add-tag-choose-existed" onclick = "addExisting(event)"> ‚úîÔ∏è choose existed</button>
    <button  id="code-tree-add-tag-choose-component" onclick = "choseComponent(event)"> üß© component</button>
</fieldset>



<!-- menu confirm selected append/insert tags-->
<fieldset id="code-tree-append-or-insert-approv-menu" style="user-select: none;" class="menu">
  <legend><button onclick = "cancel(event)" style="font-size: 0.9em;">‚ùå</button></legend>    
  <span></span><span id="code-tree-amount-selected-for-append-or-insert" >0</span> selected</span>  
  <button id="code-tree-click-tag-approve" onclick="approve(event)"> ‚úÖ APPROVE</button>
  <label label for="code-tree-menu-dublicate-with-parent-option">‚ö†Ô∏è</label><input id="code-tree-menu-dublicate-with-parent-option" type="checkbox"><label for="code-tree-menu-dublicate-with-parent-option">Duplicate with Parent</label>
</fieldset>


<!-- menu to receive inner html -->
<fieldset id="code-tree-inner-html-receive-menu" class="menu">
<legend><button onclick = "cancel(event)" style="font-size: 0.9em;">‚ùå</button></legend>    
<textarea placeholder="üìÑinner HTML" id="code-tree-inner-html-receive-textarea" style="min-width: 150px; min-height: 50px; max-width: 90vw;"></textarea>
<br>
<button id="code-tree-inner-html-receiver-save-" onclick ="save(event)">üíæ save</button>

</fieldset>


<!--menu to view and edit attributes-->
<div class="menu"id="code-tree-tag-attributes-form" style="display: flex; flex-direction: column; align-items: flex-end;">
  <table id="code-tree-tag-attributes-list">
    <tr>
      <td><input id="code-tree-tag-attribute-input-key" type="text" placeholder="attribute üîë" ></td>
      <td><input id="code-tree-tag-attribute-input-key-value" type="text" placeholder="value üìÑ">
        <button id="code-tree-tag-attribute-add">‚ûï add</button></td>
      <td><button onclick = "cancel(event)" style="font-size: 0.9em;">‚ùå</button></td>
    </tr>
    <tr id="code-tree-tag-attributes-list-item">
      <td>üîë<span id="code-tree-tag-attribute-key">data-type</span></td>
      <td>üìÑ<span id="code-tree-tag-attribute-value">cool product<span></td>
      <td><button id="code-tree-tag-attribute-remove-button">&#128465;</button></td>
      </tr>
    </table>
   </div>
<!--menu choose from tags tabble-->
<fieldset id ="tag-table" class="menu">
  <legend><button onclick = "cancel(event)" style="font-size: 0.9em;">‚ùå</button></legend>
  <h2>choose tag</h2>
          <table id="tagsTable" class="tagsTable-style">
            <thead>
              <tr>
                  <th><input type="text" id="searchTagName" placeholder="Search by Tag Name" onkeyup="filterTable(0)"></th>
                  <th><input type="text" id="searchTagValue" placeholder="Search by Tag Value" onkeyup="filterTable(1)"></th>
                  <th><input type="text" id="searchTagType" placeholder="Search by Tag Type" onkeyup="filterTable(2)"></th>
                  <th><input type="text" id="searchTagComment" placeholder="Search by Tag Comment" onkeyup="filterTable(3)"></th>
              </tr>
              <tr>
                  <th>Tag Name</th>
                  <th>Tag Value</th>
                  <th>Tag Type</th>
                  <th>Tag Comment</th>
              </tr>
          </thead>
          <tbody>
          </tbody>
          </table>
</fieldset>
</div>
</main>
<aside style="overflow-y: auto;">
  <span id="last-action-time" style="font-size: 2.2em;"></span>
  <table id="code-log">
    <thead>
      <tr>
          <th style="text-align: left;">üïìtime</th>
          <th style="text-align: left;">‚úîÔ∏èaction</th>
      </tr>
  </thead>
  <tbody id="code-log-body">
      <tr id="code-log-element" hidden>
          <td data-type-code-log="action-time"><span id="code-log-action-time">24.01.01 23:59</span></td>
          <td data-type-code-log="action-name"><span id="code-log-action">append child</span></td>
          <td><button data-type-code-log="action-remove" style="font-size: 1.2em; border: none;">&#128465;</button></td> 
      </tr>
  </tbody>
  
</div>
</aside>
</div>


<!--loading screen-->
<div  id="loading"  style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.5); display: none; justify-content: center; align-items: center; z-index: 900;">
  <span  style="font-size: 10.2em; color: white;">‚è≥</span>
  <div id="timer" style="font-size: 2em; color: white;">1.12</div>
</div>


<!--loading script-->
<script>
  /*
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('button').forEach(function(button) {
        button.addEventListener('click', function() {
          const loadingScreen = document.getElementById('loading');
            loadingScreen.style.display = 'flex';

            const timerElement = document.getElementById('timer');
            let tenthsOfSeconds = 0;
            const interval = setInterval(function() {
                tenthsOfSeconds++;
                timerElement.textContent = (tenthsOfSeconds / 10).toFixed(1);
            }, 100);

            const randomTime = Math.random() * 1000 + 100; 

            setTimeout(function() {
                loadingScreen.style.display = 'none';
                clearInterval(interval);

                const lastActionTime = document.getElementById('last-action-time');
                lastActionTime.textContent = timerElement.textContent;
            }, randomTime);
        });
    });
});
*/
</script>


<script>
  var actionLog = []
  var selected = []
  function toggleSubFields(event) {
    // Get the clicked button and its content
    const button = event.target;
    const buttonContent = button.innerHTML;

    // Get the parent fieldset
    const parentFieldset = button.closest('fieldset[data-element="code-tree-tag"]');

    if (parentFieldset) {
        // Find all sub fieldsets inside the parent fieldset
        const subFieldsets = parentFieldset.querySelectorAll('fieldset[data-element="code-tree-tag"]');

        // Toggle the visibility of sub fieldsets
        subFieldsets.forEach(subFieldset => {
            subFieldset.hidden = !subFieldset.hidden;
        });

        // Toggle the button content
        button.innerHTML = buttonContent === '‚Üí' ? '‚Üì' : '‚Üí';
    }
}
  function handleCheckboxChange(event) {
    var checkbox = event.target;
    var fieldsetId = checkbox.parentNode.id;

    if (checkbox.checked) {
        // Add the ID to the selected array
        selected.push(fieldsetId);
    } else {
        // Remove the ID from the selected array
        var index = selected.indexOf(fieldsetId);
        if (index !== -1) {
            selected.splice(index, 1);
        }
    }

    // Update the content of the span with the length of the selected array
    var amountSelectedSpan = document.getElementById('code-tree-amount-selected-for-append-or-insert');
    if (amountSelectedSpan) {
        amountSelectedSpan.textContent = selected.length;
    }

    // Log the selected array (you can replace this with your desired logic)
    console.log("Selected Fieldsets:", selected);
    var arrowButton = checkbox.parentNode.querySelector('[data-element="code-tree-show-hide-button"]');
        if (checkbox.checked) {
            arrowButton.textContent = '‚Üì'  ;
        }
        else{
          arrowButton.textContent = '‚Üí'  ;
        }
    // Hide all subfieldsets and enable their checkboxes
    hideSubFieldsets(checkbox.parentNode, checkbox.checked);
}
function hideSubFieldsets(parentFieldSet, hide) {
    // Get all fieldsets with data-element="code-tree-tag" under the specified parent
    var subFieldsets = parentFieldSet.querySelectorAll('fieldset[data-element="code-tree-tag"]');

    // Iterate through each subfieldset and toggle visibility
    subFieldsets.forEach(function (subFieldset) {
        // Toggle visibility using the hidden attribute
        subFieldset.hidden = hide;

        // Enable or disable the checkbox based on the hide parameter
        var subCheckbox = subFieldset.querySelector('input[type="checkbox"]');
        if (subCheckbox) {
            subCheckbox.disabled = false;
        }

        // If hiding, remove the subFieldsetId from the selected array
        if (hide) {
            var subFieldsetId = subFieldset.id;
            var index = selected.indexOf(subFieldsetId);
            if (index !== -1) {
                selected.splice(index, 1);
            }
        }

        
    });
}
  function generateUUID() {
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
      const r = Math.random() * 16 | 0,
        v = c === 'x' ? r : (r & 0x3 | 0x8);
      return v.toString(16);
    });
  }
  const pushAction = (e)=>{
    actionLog.push(e)
    executeCommand(e)
    insertDataIntoCodeLog(e.time,e.action)
  }
  function insertDataIntoCodeLog(actionTime, actionName) {
    const originalElement = document.getElementById("code-log-element");
    const clonedElement = originalElement.cloneNode(true);

    // Remove the unwanted button from the cloned element
    const removeButtonCell = originalElement.querySelector("[data-type-code-log='action-remove']");
    if (removeButtonCell) {
      removeButtonCell.parentNode.removeChild(removeButtonCell);
    }

    // Set the content and attributes for the cloned element
    clonedElement.removeAttribute("hidden");
    clonedElement.querySelector("#code-log-action-time").textContent = actionTime;
    clonedElement.querySelector("#code-log-action").textContent = actionName;

    // Get the parent of the original element
    const parent = originalElement.parentNode;

    // Insert the cloned element before the original element
    parent.insertBefore(clonedElement, originalElement);
  }
  const executeCommand = (command) => {
    const { action, target_element, insertedCode ,tag_change,inserted_element} = command;
let treeElement
let componentElement
function handleAppendOrInsert(action, selectedArrayNotSorted) {
    // Sort
    var firstElementId = selectedArrayNotSorted[0];
    var restOfElements = selectedArrayNotSorted.slice(1);

    // Sort the rest of the elements by their order in the DOM
    restOfElements.sort(function (a, b) {
        var elementA = document.getElementById(a);
        var elementB = document.getElementById(b);

        return Array.from(elementA.parentElement.children).indexOf(elementA) -
            Array.from(elementB.parentElement.children).indexOf(elementB);
    });

    // Combine the sorted array with the first element
    var selectedArray = [firstElementId, ...restOfElements];

    // Find the target fieldset based on the ID
    var targetElementId = selectedArray[0];
    console.log('selected'+JSON.stringify(selectedArray))
    // Find the target fieldset based on the ID
    var targetFieldset = document.getElementById(targetElementId);
    var targetFieldset2 = document.getElementById(targetElementId.replace('-tree',""));

    // Get the parent fieldset of the target
    var parentFieldset = targetFieldset.parentNode;
    var parentFieldset2 = targetFieldset2.parentNode

    // Get the index of the target fieldset within its parent
    var index = Array.from(parentFieldset.children).indexOf(targetFieldset);
    var index2 = Array.from(parentFieldset2.children).indexOf(targetFieldset2);

    // Iterate through the selected array (skipping the first element, which is the target)
    for (var i = 1; i < selectedArray.length; i++) {
        var selectedId = selectedArray[i];

        // Find all elements based on the selected ID and its replacement
        var selectedElements = document.querySelectorAll('[id^="' + selectedId + '"]');
        var selectedElements2 = document.querySelectorAll('[id^="' + selectedId.replace('-tree',"") + '"]');

        // Iterate through each selected element and process it
        selectedElements.forEach(function(selectedFieldset) {
            // Clone the selected fieldset and its descendants
            var clonedFieldset = cloneWithDescendants(selectedFieldset);
            var arrowButton = clonedFieldset.querySelector('[data-element="code-tree-show-hide-button"]');
              
                arrowButton.textContent = '‚Üí'  ;
            // Insert the cloned fieldset based on the action
            if (action === 'Append') {
                targetFieldset.appendChild(clonedFieldset);
            } else if (action === 'InsertBefore') {
                
                parentFieldset.insertBefore(clonedFieldset, parentFieldset.children[index]);
                index++; // Increment the index to maintain the correct order
            }

            // Remove the original fieldset
            selectedFieldset.remove();
        });
        selectedElements2 = Array.from(selectedElements2).filter(function(element) {
            return !element.id.includes('-tree');
        });
        selectedElements2.forEach(function(selectedFieldset2) {
            // Clone the selected fieldset and its descendants
            var clonedFieldset2 = cloneWithDescendants(selectedFieldset2);

            // Insert the cloned fieldset based on the action
            if (action === 'Append') {
                targetFieldset2.appendChild(clonedFieldset2);
            } else if (action === 'InsertBefore') {
                
              
                parentFieldset2.insertBefore(clonedFieldset2, parentFieldset2.children[index2]);
                index2++; // Increment the index to maintain the correct order
            }

            // Remove the original fieldset
            selectedFieldset2.remove();
        });
    }
}
function cloneWithDescendants(element) {
    var clone = element.cloneNode(true);
    var clonedSubFieldsets = clone.querySelectorAll('fieldset[data-element="code-tree-tag"]');
    clonedSubFieldsets.forEach(function (clonedSubFieldset) {
        clonedSubFieldset.hidden = false;
    });
    const buttons = clone.querySelectorAll("[data-element='code-tree-show-hide-button']");

    buttons.forEach(function (button) {
        button.addEventListener('mouseover', mouseOverTree);
        button.addEventListener('mouseout', mouseOutTree);
    });
    

    return clone;
}

switch (action) {
  case 'Append':
    // Handle the 'Append' action
    

    //case insert tag
    if(inserted_element?.tagName){
      //fieldset
      treeElement = document.getElementById(target_element);
      //component
      componentElement = document.getElementById(target_element.replace('-tree',''));
      const newEl = document.createElement(inserted_element.tagName)
      newEl.id = inserted_element.id
      console.log(newEl.id)
      componentElement.appendChild(newEl)
      const component_el = document.getElementById('component-element')
      const newEl2 = component_el.cloneNode(true)
      const button2 = newEl2.querySelector("[data-element='code-tree-tag-name-button']")
      button2.textContent = 'üè∑Ô∏è'+inserted_element.tagName;
      const button = newEl2.querySelector("[data-element='code-tree-show-hide-button']")
      button.addEventListener('mouseover', mouseOverTree);

      button.addEventListener('mouseout', mouseOutTree);
      newEl2.id = inserted_element.id + '-tree'
      treeElement.appendChild(newEl2)
      break;
    }
    if(target_element.length){
      handleAppendOrInsert('Append',target_element.map(i=>i.id))
    }
    break;

  case 'InsertBefore':
    // Handle the 'InsertBefore' action
    // Handle the 'Append' action
    //fieldset
    

    //case insert tag
    if(inserted_element?.tagName){
      treeElement = document.getElementById(target_element);
      //component
      componentElement = document.getElementById(target_element.replace('-tree',''));
      const newEl = document.createElement(inserted_element.tagName)
      newEl.id = inserted_element.id
      console.log(newEl.id)
      componentElement.parentNode.insertBefore(newEl,componentElement)
      const component_el = document.getElementById('component-element')
      const newEl2 = component_el.cloneNode(true)
      const button2 = newEl2.querySelector("[data-element='code-tree-tag-name-button']")
      button2.textContent = 'üè∑Ô∏è'+inserted_element.tagName;
      const button = newEl2.querySelector("[data-element='code-tree-show-hide-button']")
      button.addEventListener('mouseover', mouseOverTree);

      button.addEventListener('mouseout', mouseOutTree);
      newEl2.id = inserted_element.id
      treeElement.parentNode.insertBefore(newEl2,treeElement)
    }
    if(target_element.length){
      console.log(JSON.stringify(target_element))
      handleAppendOrInsert('InsertBefore',target_element.map(i=>i.id))
    }
    
    break;

  case 'innerHtml':
    // Handle the 'innerHtml' action
    const targetElement = document.getElementById(target_element.replace('-tree',''));
    targetElement.innerHTML = insertedCode;
    
    break;

  case 'ChangeTag':
    // Handle the 'ChangeTag' action
    // tree el
    const elementToChange = document.getElementById(target_element);
    elementToChange.querySelector("[data-element='code-tree-tag-name-button']").textContent = tag_change; 
    // builder el
    const elementToChange2 = document.getElementById(target_element.replace('-tree',''));
      if (elementToChange2) {
        // Create a new p element
        var newElement = document.createElement(tag_change);

        // Copy attributes from the div to the p element
        for (var i = 0; i < elementToChange2.attributes.length; i++) {
            var attribute = elementToChange2.attributes[i];
            newElement.setAttribute(attribute.name, attribute.value);
        }

        // Copy content from the div to the p element
        newElement.innerHTML = elementToChange2.innerHTML;

        // Replace the div element with the new p element
        elementToChange2.parentNode.replaceChild(newElement, elementToChange2);
    }
    break;

  case 'dublicateTag':
    // Handle the 'dublicateTag' action
    const originalElement = document.getElementById(target_element);
    const duplicatedElement = originalElement.cloneNode(true);
    //to do
    duplicatedElement.id = duplicatedElement.id + '-copy'
    
    originalElement.parentNode.appendChild(duplicatedElement);
    break;

  case 'removeTag':
    // Handle the 'removeTag' action
    // tree
    const elementToRemove = document.getElementById(target_element);
    elementToRemove.parentNode.removeChild(elementToRemove);

    // component
    const elementToRemove2 = document.getElementById(target_element.replace('tree',''));
    elementToRemove2.parentNode.removeChild(elementToRemove2);


    break;

  // Add more cases as needed for other actions

  default:
    // Handle the default case if no matching action is found
    console.error(`Unknown action: ${action}`);
    break;
}

  }
  async function loader(e, handler) {
      const loadingScreen = document.getElementById('loading');
      loadingScreen.style.display = 'flex';
      const prefixesToRemove = [
        'component-element',
        'component-replace-menu',
        'code-tree-tag-attributes-form',
        'code-tree-click-tag',
        'code-tree-add-tag-step-1',
        'code-tree-append-or-insert-approv-menu',
        'code-tree-inner-html-receive-menu',
        'tag-table'
      ];

      prefixesToRemove.forEach(prefix => {
          const p = document.getElementById("code-tree")
          const elementsToRemove = p.querySelectorAll(`fieldset[id^="${prefix}"]`);
          elementsToRemove.forEach(element => element.remove());
      });
      const timerElement = document.getElementById('timer');
      let tenthsOfSeconds = 0;
      const interval = setInterval(function () {
        tenthsOfSeconds++;
        timerElement.textContent = (tenthsOfSeconds / 10).toFixed(1);
      }, 100);

      await handler(e);

      loadingScreen.style.display = 'none';
      clearInterval(interval);
      console.log(timerElement.textContent)
      const lastActionTime = document.getElementById('last-action-time');
      lastActionTime.textContent = timerElement.textContent;
    }

    function handleComponentClick(event) {
      const button = event.target.closest('button[data-element="code-tree-tag-name-button"]');
      
      if (button) {
        const parentId = button.parentNode.id;
        const textContentButton = button.parentNode.querySelector('[data-element="code-tree-text-content-button"]');
        
        // Check if a cloned fieldset already exists after the parent node
        const existingClonedFieldset = button.parentNode.querySelector('[id^="code-tree-click-tag"]');
        
        if (!existingClonedFieldset) {
            // Clone the fieldset node
            const fieldset = document.getElementById('code-tree-click-tag');
            const clonedFieldset = fieldset.cloneNode(true);

            // Assign a unique id to the cloned fieldset
            clonedFieldset.id = 'code-tree-click-tag;' + parentId;

            // Find the position to insert the cloned fieldset
            const insertAfterElement = textContentButton || button;

            // Insert the cloned fieldset after the specified element
            insertAfterElement.parentNode.insertBefore(clonedFieldset, insertAfterElement.nextElementSibling);
        }
      }
}
  document.addEventListener('DOMContentLoaded', function () {
    

    


    //first menu
    let buttons = document.querySelectorAll('button[data-element="code-tree-tag-name-button"]');
    buttons.forEach(function (button) {
      button.addEventListener('click', e => loader(e, handleComponentClick));
    });


    
  });
  const save =(event)=>{
    const parent = event.target.parentNode
    const {id } = parent
    const action = parent.getAttribute('action')
    console.log('ac' + action)
    if(action ==='innerHtml'){
      const saveButton = event.target;
      const fieldset = saveButton.closest('fieldset');
        
        
      const textareaValue = fieldset.querySelector('#code-tree-inner-html-receive-textarea').value;
            
        
      const el = {
        time: (new Date()).getTime(),
        action,
        target_element:id.split(';')[1],
        insertedCode:textareaValue,

      }
      console.log(JSON.stringify(el))
      pushAction(el)
    }
    parent.remove()
    console.log(JSON.stringify(actionLog))

  }
  
</script>
<script>

  //second menu 
  
  const cancel = (e)=>{
    
    e.target.parentNode.parentNode.remove()
  }
  const append = (e)=>{
    const parentId = e.target.parentNode.id.split(';')[1];
        const fieldset = document.getElementById('code-tree-add-tag-step-1');

        if (!e.target.parentNode.nextElementSibling || !e.target.parentNode.nextElementSibling.id.startsWith('code-tree-add-tag-step-1') ) {
          const clonedFieldset = fieldset.cloneNode(true);
          
          clonedFieldset.id = clonedFieldset.id  + ';'+parentId;
          clonedFieldset.setAttribute('action','Append')
          e.target.parentNode.insertAdjacentElement('afterend', clonedFieldset);
          e.target.parentNode.remove()
        }
  }
  const insertB = (e)=>{
      
      
        const parentId = e.target.parentNode.id.split(';')[1];
        const fieldset = document.getElementById('code-tree-add-tag-step-1');

        if (!e.target.parentNode.nextElementSibling || !e.target.parentNode.nextElementSibling.id.startsWith('code-tree-add-tag-step-1') ) {
          const clonedFieldset = fieldset.cloneNode(true);
          
          clonedFieldset.id = clonedFieldset.id  + ';'+parentId;
          clonedFieldset.setAttribute('action','InsertBefore')
          e.target.parentNode.insertAdjacentElement('afterend', clonedFieldset);
          e.target.parentNode.remove()
        }
      
  }
  const insertHtml = (e)=>{
    
    const parentId = e.target.parentNode.id.split(';')[1];
        const fieldset = document.getElementById('code-tree-inner-html-receive-menu');

        if (!e.target.parentNode.nextElementSibling || !e.target.parentNode.nextElementSibling.id.startsWith('code-tree-inner-html-receive-menu') ) {
          const clonedFieldset = fieldset.cloneNode(true);
          
          clonedFieldset.id = clonedFieldset.id  + ';'+parentId;
          clonedFieldset.setAttribute('action', 'innerHtml')
          e.target.parentNode.insertAdjacentElement('afterend', clonedFieldset);
          e.target.parentNode.remove()
        }
  }
  const changeTag = (e)=>{
    const parentId = e.target.parentNode.id.split(';')[1];
        const fieldset = document.getElementById('tag-table');

        if (!e.target.parentNode.nextElementSibling || !e.target.parentNode.nextElementSibling.id.startsWith('tag-table') ) {
          const clonedFieldset = fieldset.cloneNode(true);

          
          const clonedRows = clonedFieldset.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
          for (let i = 0; i < clonedRows.length; i++) {
            const index = i; // Capture the current value of 'i' in a closure
            clonedRows[i].onclick = function (event) {
              chooseTag(index,event);
            };
          }
          clonedFieldset.id = clonedFieldset.id  + ';'+parentId;
          clonedFieldset.setAttribute('action', 'ChangeTag')
          e.target.parentNode.insertAdjacentElement('afterend', clonedFieldset);
          e.target.parentNode.remove()
        }
  }
  const duplicateTag = (e)=>{
    const parentId = e.target.parentNode.id.split(';')[1];
    const el =    
    {
        time: (new Date()).getTime(),
        action:'dublicateTag',
        target_element:parentId,
        inserted_element:generateUUID()

      }
      pushAction(el)
  }
  const removeTag = (e)=>{
    const parentId = e.target.parentNode.id.split(';')[1];
    const el =    
    {
        time: (new Date()).getTime(),
        action:'removeTag',
        target_element:parentId,

      }
      pushAction(el)
      e.target.parentNode.remove()
  }
  const approve = (event)=>{
    var checkbox = event.target;

      // Get the parent fieldset
      var fieldset = checkbox.closest('fieldset');

      // Get the id and action attributes
      var fieldsetId = fieldset.id;
      var fieldsetAction = fieldset.getAttribute('action');

      // Get all fieldsets with data-element="code-tree-tag"
      var codeTreeTagFieldsets = document.querySelectorAll('fieldset[data-element="code-tree-tag"]');

      // Iterate through each fieldset and hide them
      codeTreeTagFieldsets.forEach(function (fieldset) {
          var checkbox = fieldset.querySelector('input[type="checkbox"]');
          if (checkbox) {
              checkbox.setAttribute('hidden', 'true');
          }
      });

      // Remove the parent fieldset
      fieldset.remove();

      // Log the id and action attributes (you can replace this with your desired logic)
      console.log("Fieldset ID:", fieldsetId);
      console.log("Fieldset Action:", fieldsetAction);
      const el = {
        time: (new Date()).getTime(),
        action:fieldsetAction,
        target_element:[{type:'tag',id:fieldsetId.split(';')[1],},... selected.map(id=>{
          return {type:'tag',id}
        })],
        

      }
      selected = []
      pushAction(el)
      e.target.parentNode.remove()
  }

</script>

<!-- tag style-->
<style>

[data-element="code-tree-tag"],
[data-element="component-tree-tag"] {
  user-select: none;
}

[data-element="code-tree-tag"] legend,
[data-element="component-tree-tag"] legend {
  margin-bottom: -6px;
  margin-top: 5px;
}
  [data-element="component-tree-tag"],
  [data-element="code-tree-tag"] {
  border-bottom: none;
  border-right: none;
}



[data-element="code-tree-tag"] input[type="checkbox"] {
  transform: scale(1.2);
}

[data-element="component-tree-tag"] button,
[data-element="code-tree-tag"] button {
  font-size: 1.2em;
}

[data-element="component-tree-css-button"],
[data-element="code-tree-attributes-button"] {
  position: absolute;
  right: 145px;
  margin-right: 5px;
}
[data-element="code-tree-text-content-button"] {
  position: absolute;
  right: 145px;
  margin-right: 5px;
}


[data-element="component-tree-js-button"]:last-of-type,
[data-element="code-tree-attributes-button"]:last-of-type {
  position: absolute;
  right: 0px;
  margin-left:5px;
}
[data-element="code-tree-text-content-button"]:last-of-type {
  position: absolute;
  right: 0px;
  margin-left:5px;
}

[data-element="component-tree-css-button"] {
  position: absolute;
  right: 70px;
  margin-right: 5px;
}


[data-element="component-tree-js-button"]:last-of-type {
  position: absolute;
  right: 0px;
  margin-left:5px;
}


</style>


<script>

  //third menu 
  const addNew = (e)=>{
    const parentId = e.target.parentNode.id.split(';')[1];
        const fieldset = document.getElementById('tag-table');

        if (!e.target.parentNode.nextElementSibling || !e.target.parentNode.nextElementSibling.id.startsWith('tag-table') ) {
          const clonedFieldset = fieldset.cloneNode(true);
          
          const clonedRows = clonedFieldset.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
          for (let i = 0; i < clonedRows.length; i++) {
            const index = i; // Capture the current value of 'i' in a closure
            clonedRows[i].onclick = function (event) {
              chooseTag(index,event);
            };
          }
          clonedFieldset.id = clonedFieldset.id  + ';'+parentId;
          clonedFieldset.setAttribute('action', e.target.parentNode.getAttribute('action'))
          e.target.parentNode.insertAdjacentElement('afterend', clonedFieldset);
          e.target.parentNode.remove()
        }
  }
  const addExisting = (e)=>{
    const parentId = e.target.parentNode.id.split(';')[1];
        const fieldset = document.getElementById('code-tree-append-or-insert-approv-menu');

        if (!e.target.parentNode.nextElementSibling || !e.target.parentNode.nextElementSibling.id.startsWith('code-tree-append-or-insert-approv-menu') ) {
          const clonedFieldset = fieldset.cloneNode(true);
          
          clonedFieldset.id = clonedFieldset.id  + ';'+parentId;
          clonedFieldset.setAttribute('action', e.target.parentNode.getAttribute('action'))
          e.target.parentNode.insertAdjacentElement('afterend', clonedFieldset);
          e.target.parentNode.remove()
          // Get all fieldsets with data-element="code-tree-tag"
          var codeTreeTagFieldsets = document.querySelectorAll('fieldset[data-element="code-tree-tag"]');

          // Iterate through each fieldset and make their checkboxes visible
          codeTreeTagFieldsets.forEach(function (fieldset) {
              var checkbox = fieldset.querySelector('input[type="checkbox"]');
              if (checkbox) {
                  checkbox.removeAttribute('hidden');
              }
          });
        }

  }
  const choseComponent = (e)=>{

  }
  

</script>


<!-- attributes table style-->
<style>
        
        
  #code-tree-tag-attributes-list  tr:nth-child(odd) {
    background-color: #f0f0f0; 
  }

  #code-tree-tag-attributes-list tr:hover {
    background-color: #dddddd; 
  }
  #code-tree-tag-attributes-list {
    border-collapse: collapse; 
  }

  #code-tree-tag-attributes-list td {
    padding: 7px; 
    word-wrap: break-word; 
  }
</style>
<!-- tags table style-->
<style>
  .tagsTable-style th, .tagsTable-style td {
    padding: 5px;
    text-align: left;
  }
  .tagsTable-style tr:nth-child(even) {
    background-color: #f2f2f2;
  }
  .tagsTable-style input[type="text"] {
    width: 100%;
    box-sizing: border-box;
  }
  .tagsTable-style tr:hover {
    cursor: pointer;
    background-color: #ddd;
  }
  </style>


<!-- tags table script-->
  <script>          const tags = 
  [

{
 "tagName": "txt",
 "tagValue": "<txt></txt>",
 "TagComment": "Contains text content",
 "TagType": "Custom"
},
{
 "tagName": "doctype",
 "tagValue": "<!DOCTYPE>",
 "TagComment": "Defines the document type",
 "TagType": "Basic HTML"
},
{
 "tagName": "html",
 "tagValue": "<html></html>",
 "TagComment": "Defines an HTML document",
 "TagType": "Basic HTML"
},
{
 "tagName": "head",
 "tagValue": "<head></head>",
 "TagComment": "Contains metadata/information for the document",
 "TagType": "Basic HTML"
},
{
 "tagName": "title",
 "tagValue": "<title></title>",
 "TagComment": "Defines a title for the document",
 "TagType": "Basic HTML"
},
{
 "tagName": "body",
 "tagValue": "<body></body>",
 "TagComment": "Defines the document's body",
 "TagType": "Basic HTML"
},
{
 "tagName": "h1",
 "tagValue": "<h1></h1>",
 "TagComment": "Defines HTML headings",
 "TagType": "Basic HTML"
},
{
 "tagName": "h2",
 "tagValue": "<h2></h2>",
 "TagComment": "Defines HTML headings",
 "TagType": "Basic HTML"
},
{
 "tagName": "h3",
 "tagValue": "<h3></h3>",
 "TagComment": "Defines HTML headings",
 "TagType": "Basic HTML"
},
{
 "tagName": "h4",
 "tagValue": "<h4></h4>",
 "TagComment": "Defines HTML headings",
 "TagType": "Basic HTML"
},
{
 "tagName": "h5",
 "tagValue": "<h5></h5>",
 "TagComment": "Defines HTML headings",
 "TagType": "Basic HTML"
},
{
 "tagName": "h6",
 "tagValue": "<h6></h6>",
 "TagComment": "Defines HTML headings",
 "TagType": "Basic HTML"
},
{
 "tagName": "p",
 "tagValue": "<p></p>",
 "TagComment": "Defines a paragraph",
 "TagType": "Basic HTML"
},
{
 "tagName": "br",
 "tagValue": "<br>",
 "TagComment": "Inserts a single line break",
 "TagType": "Basic HTML"
},
{
 "tagName": "hr",
 "tagValue": "<hr>",
 "TagComment": "Defines a thematic change in the content",
 "TagType": "Basic HTML"
},
{
 "tagName": "!--...--",
 "tagValue": "<!--...-->",
 "TagComment": "Defines a comment",
 "TagType": "Basic HTML"
},
{
 "tagName": "abbr",
 "tagValue": "<abbr></abbr>",
 "TagComment": "Defines an abbreviation or an acronym",
 "TagType": "Formatting"
},
{
 "tagName": "address",
 "tagValue": "<address></address>",
 "TagComment": "Defines contact information for the author/owner of a document/article",
 "TagType": "Formatting"
},
{
 "tagName": "b",
 "tagValue": "<b></b>",
 "TagComment": "Defines bold text",
 "TagType": "Formatting"
},
{
 "tagName": "bdi",
 "tagValue": "<bdi></bdi>",
 "TagComment": "Isolates a part of text that might be formatted in a different direction from other text outside it",
 "TagType": "Formatting"
},
{
 "tagName": "bdo",
 "tagValue": "<bdo></bdo>",
 "TagComment": "Overrides the current text direction",
 "TagType": "Formatting"
},
{
 "tagName": "blockquote",
 "tagValue": "<blockquote></blockquote>",
 "TagComment": "Defines a section that is quoted from another source",
 "TagType": "Formatting"
},
{
 "tagName": "cite",
 "tagValue": "<cite></cite>",
 "TagComment": "Defines the title of a work",
 "TagType": "Formatting"
},
{
 "tagName": "code",
 "tagValue": "<code></code>",
 "TagComment": "Defines a piece of computer code",
 "TagType": "Formatting"
},
{
 "tagName": "del",
 "tagValue": "<del></del>",
 "TagComment": "Defines text that has been deleted from a document",
 "TagType": "Formatting"
},
{
 "tagName": "dfn",
 "tagValue": "<dfn></dfn>",
 "TagComment": "Specifies a term that is going to be defined within the content",
 "TagType": "Formatting"
},
{
 "tagName": "em",
 "tagValue": "<em></em>",
 "TagComment": "Defines emphasized text",
 "TagType": "Formatting"
},
{
 "tagName": "i",
 "tagValue": "<i></i>",
 "TagComment": "Defines a part of text in an alternate voice or mood",
 "TagType": "Formatting"
},
{
 "tagName": "ins",
 "tagValue": "<ins></ins>",
 "TagComment": "Defines a text that has been inserted into a document",
 "TagType": "Formatting"
},
{
 "tagName": "kbd",
 "tagValue": "<kbd></kbd>",
 "TagComment": "Defines keyboard input",
 "TagType": "Formatting"
},
{
 "tagName": "mark",
 "tagValue": "<mark></mark>",
 "TagComment": "Defines marked/highlighted text",
 "TagType": "Formatting"
},
{
 "tagName": "meter",
 "tagValue": "<meter></meter>",
 "TagComment": "Defines a scalar measurement within a known range (a gauge)",
 "TagType": "Formatting"
},
{
 "tagName": "pre",
 "tagValue": "<pre></pre>",
 "TagComment": "Defines preformatted text",
 "TagType": "Formatting"
},
{
 "tagName": "progress",
 "tagValue": "<progress></progress>",
 "TagComment": "Represents the progress of a task",
 "TagType": "Formatting"
},
{
 "tagName": "q",
 "tagValue": "<q></q>",
 "TagComment": "Defines a short quotation",
 "TagType": "Formatting"
},
{
 "tagName": "rp",
 "tagValue": "<rp></rp>",
 "TagComment": "Defines what to show in browsers that do not support ruby annotations",
 "TagType": "Formatting"
},
{
 "tagName": "rt",
 "tagValue": "<rt></rt>",
 "TagComment": "Defines an explanation/pronunciation of characters (for East Asian typography)",
 "TagType": "Formatting"
},
{
 "tagName": "ruby",
 "tagValue": "<ruby></ruby>",
 "TagComment": "Defines a ruby annotation (for East Asian typography)",
 "TagType": "Formatting"
},
{
 "tagName": "s",
 "tagValue": "<s></s>",
 "TagComment": "Defines text that is no longer correct",
 "TagType": "Formatting"
},
{
 "tagName": "samp",
 "tagValue": "<samp></samp>",
 "TagComment": "Defines sample output from a computer program",
 "TagType": "Formatting"
},
{
 "tagName": "small",
 "tagValue": "<small></small>",
 "TagComment": "Defines smaller text",
 "TagType": "Formatting"
},
{
 "tagName": "strong",
 "tagValue": "<strong></strong>",
 "TagComment": "Defines important text",
 "TagType": "Formatting"
},
{
 "tagName": "sub",
 "tagValue": "<sub></sub>",
 "TagComment": "Defines subscripted text",
 "TagType": "Formatting"
},
{
 "tagName": "sup",
 "tagValue": "<sup></sup>",
 "TagComment": "Defines superscripted text",
 "TagType": "Formatting"
},
{
 "tagName": "template",
 "tagValue": "<template></template>",
 "TagComment": "Defines a container for content that should be hidden when the page loads",
 "TagType": "Formatting"
},
{
 "tagName": "time",
 "tagValue": "<time></time>",
 "TagComment": "Defines a specific time (or datetime)",
 "TagType": "Formatting"
},
{
 "tagName": "u",
 "tagValue": "<u></u>",
 "TagComment": "Defines some text that is unarticulated and styled differently from normal text",
 "TagType": "Formatting"
},
{
 "tagName": "var",
 "tagValue": "<var></var>",
 "TagComment": "Defines a variable",
 "TagType": "Formatting"
},
{
 "tagName": "wbr",
 "tagValue": "<wbr>",
 "TagComment": "Defines a possible line-break",
 "TagType": "Formatting"
},
{
 "tagName": "form",
 "tagValue": "<form></form>",
 "TagComment": "Defines an HTML form for user input",
 "TagType": "Forms and Input"
},
{
 "tagName": "input",
 "tagValue": "<input>",
 "TagComment": "Defines an input control",
 "TagType": "Forms and Input"
},
{
 "tagName": "textarea",
 "tagValue": "<textarea></textarea>",
 "TagComment": "Defines a multiline input control (text area)",
 "TagType": "Forms and Input"
},
{
 "tagName": "button",
 "tagValue": "<button></button>",
 "TagComment": "Defines a clickable button",
 "TagType": "Forms and Input"
},
{
 "tagName": "select",
 "tagValue": "<select></select>",
 "TagComment": "Defines a drop-down list",
 "TagType": "Forms and Input"
},
{
 "tagName": "optgroup",
 "tagValue": "<optgroup></optgroup>",
 "TagComment": "Defines a group of related options in a drop-down list",
 "TagType": "Forms and Input"
},
{
 "tagName": "option",
 "tagValue": "<option></option>",
 "TagComment": "Defines an option in a drop-down list",
 "TagType": "Forms and Input"
},
{
 "tagName": "label",
 "tagValue": "<label></label>",
 "TagComment": "Defines a label for an <input> element",
 "TagType": "Forms and Input"
},
{
 "tagName": "fieldset",
 "tagValue": "<fieldset></fieldset>",
 "TagComment": "Groups related elements in a form",
 "TagType": "Forms and Input"
},
{
 "tagName": "legend",
 "tagValue": "<legend></legend>",
 "TagComment": "Defines a caption for a <fieldset> element",
 "TagType": "Forms and Input"
},
{
 "tagName": "datalist",
 "tagValue": "<datalist></datalist>",
 "TagComment": "Specifies a list of pre-defined options for input controls",
 "TagType": "Forms and Input"
},
{
 "tagName": "output",
 "tagValue": "<output></output>",
 "TagComment": "Defines the result of a calculation",
 "TagType": "Forms and Input"
},
{
 "tagName": "iframe",
 "tagValue": "<iframe></iframe>",
 "TagComment": "Defines an inline frame",
 "TagType": "Frames"
},
{
 "tagName": "img",
 "tagValue": "<img>",
 "TagComment": "Defines an image",
 "TagType": "Images"
},
{
 "tagName": "map",
 "tagValue": "<map></map>",
 "TagComment": "Defines a client-side image map",
 "TagType": "Images"
},
{
 "tagName": "area",
 "tagValue": "<area>",
 "TagComment": "Defines an area inside an image map",
 "TagType": "Images"
},
{
 "tagName": "canvas",
 "tagValue": "<canvas></canvas>",
 "TagComment": "Used to draw graphics, on the fly, via scripting (usually JavaScript)",
 "TagType": "Images"
},
{
 "tagName": "figcaption",
 "tagValue": "<figcaption></figcaption>",
 "TagComment": "Defines a caption for a <figure> element",
 "TagType": "Images"
},
{
 "tagName": "figure",
 "tagValue": "<figure></figure>",
 "TagComment": "Specifies self-contained content",
 "TagType": "Images"
},
{
 "tagName": "picture",
 "tagValue": "<picture></picture>",
 "TagComment": "Defines a container for multiple image resources",
 "TagType": "Images"
},
{
 "tagName": "svg",
 "tagValue": "<svg></svg>",
 "TagComment": "Defines a container for SVG graphics",
 "TagType": "Images"
},
{
 "tagName": "audio",
 "tagValue": "<audio></audio>",
 "TagComment": "Defines sound content",
 "TagType": "Audio / Video"
},
{
 "tagName": "source",
 "tagValue": "<source>",
 "TagComment": "Defines multiple media resources for media elements (<video>, <audio> and <picture>)",
 "TagType": "Audio / Video"
},
{
 "tagName": "track",
 "tagValue": "<track>",
 "TagComment": "Defines text tracks for media elements (<video> and <audio>)",
 "TagType": "Audio / Video"
},
{
 "tagName": "video",
 "tagValue": "<video></video>",
 "TagComment": "Defines a video or movie",
 "TagType": "Audio / Video"
},
{
 "tagName": "a",
 "tagValue": "<a></a>",
 "TagComment": "Defines a hyperlink",
 "TagType": "Links"
},
{
 "tagName": "link",
 "tagValue": "<link>",
 "TagComment": "Defines the relationship between a document and an external resource (most used to link to style sheets)",
 "TagType": "Links"
},
{
 "tagName": "nav",
 "tagValue": "<nav></nav>",
 "TagComment": "Defines navigation links",
 "TagType": "Links"
},
{
 "tagName": "menu",
 "tagValue": "<menu></menu>",
 "TagComment": "Defines an alternative unordered list",
 "TagType": "Lists"
},
{
 "tagName": "ul",
 "tagValue": "<ul></ul>",
 "TagComment": "Defines an unordered list",
 "TagType": "Lists"
},
{
 "tagName": "ol",
 "tagValue": "<ol></ol>",
 "TagComment": "Defines an ordered list",
 "TagType": "Lists"
},
{
 "tagName": "li",
 "tagValue": "<li></li>",
 "TagComment": "Defines a list item",
 "TagType": "Lists"
},
{
 "tagName": "dl",
 "tagValue": "<dl></dl>",
 "TagComment": "Defines a description list",
 "TagType": "Lists"
},
{
 "tagName": "dt",
 "tagValue": "<dt></dt>",
 "TagComment": "Defines a term/name in a description list",
 "TagType": "Lists"
},
{
 "tagName": "dd",
 "tagValue": "<dd></dd>",
 "TagComment": "Defines a description of a term/name in a description list",
 "TagType": "Lists"
},
{
 "tagName": "table",
 "tagValue": "<table></table>",
 "TagComment": "Defines a table",
 "TagType": "Tables"
},
{
 "tagName": "caption",
 "tagValue": "<caption></caption>",
 "TagComment": "Defines a table caption",
 "TagType": "Tables"
},
{
 "tagName": "th",
 "tagValue": "<th></th>",
 "TagComment": "Defines a header cell in a table",
 "TagType": "Tables"
},
{
 "tagName": "tr",
 "tagValue": "<tr></tr>",
 "TagComment": "Defines a row in a table",
 "TagType": "Tables"
},
{
 "tagName": "td",
 "tagValue": "<td></td>",
 "TagComment": "Defines a cell in a table",
 "TagType": "Tables"
},
{
 "tagName": "thead",
 "tagValue": "<thead></thead>",
 "TagComment": "Groups the header content in a table",
 "TagType": "Tables"
},
{
 "tagName": "tbody",
 "tagValue": "<tbody></tbody>",
 "TagComment": "Groups the body content in a table",
 "TagType": "Tables"
},
{
 "tagName": "tfoot",
 "tagValue": "<tfoot></tfoot>",
 "TagComment": "Groups the footer content in a table",
 "TagType": "Tables"
},
{
 "tagName": "col",
 "tagValue": "<col>",
 "TagComment": "Specifies column properties for each column within a <colgroup> element",
 "TagType": "Tables"
},
{
 "tagName": "colgroup",
 "tagValue": "<colgroup></colgroup>",
 "TagComment": "Specifies a group of one or more columns in a table for formatting",
 "TagType": "Tables"
},
{
 "tagName": "style",
 "tagValue": "<style></style>",
 "TagComment": "Defines style information for a document",
 "TagType": "Styles and Semantics"
},
{
 "tagName": "div",
 "tagValue": "<div></div>",
 "TagComment": "Defines a section in a document",
 "TagType": "Styles and Semantics"
},
{
 "tagName": "span",
 "tagValue": "<span></span>",
 "TagComment": "Defines a section in a document",
 "TagType": "Styles and Semantics"
},
{
 "tagName": "header",
 "tagValue": "<header></header>",
 "TagComment": "Defines a header for a document or section",
 "TagType": "Styles and Semantics"
},
{
 "tagName": "hgroup",
 "tagValue": "<hgroup></hgroup>",
 "TagComment": "Defines a header and related content",
 "TagType": "Styles and Semantics"
},
{
 "tagName": "footer",
 "tagValue": "<footer></footer>",
 "TagComment": "Defines a footer for a document or section",
 "TagType": "Styles and Semantics"
},
{
 "tagName": "main",
 "tagValue": "<main></main>",
 "TagComment": "Specifies the main content of a document",
 "TagType": "Styles and Semantics"
},
{
 "tagName": "section",
 "tagValue": "<section></section>",
 "TagComment": "Defines a section in a document",
 "TagType": "Styles and Semantics"
},
{
 "tagName": "search",
 "tagValue": "<search></search>",
 "TagComment": "Defines a search section",
 "TagType": "Styles and Semantics"
},
{
 "tagName": "article",
 "tagValue": "<article></article>",
 "TagComment": "Defines an article",
 "TagType": "Styles and Semantics"
},
{
 "tagName": "aside",
 "tagValue": "<aside></aside>",
 "TagComment": "Defines content aside from the page content",
 "TagType": "Styles and Semantics"
},
{
 "tagName": "details",
 "tagValue": "<details></details>",
 "TagComment": "Defines additional details that the user can view or hide",
 "TagType": "Styles and Semantics"
},
{
 "tagName": "dialog",
 "tagValue": "<dialog></dialog>",
 "TagComment": "Defines a dialog box or window",
 "TagType": "Styles and Semantics"
},
{
 "tagName": "summary",
 "tagValue": "<summary></summary>",
 "TagComment": "Defines a visible heading for a <details> element",
 "TagType": "Styles and Semantics"
},
{
 "tagName": "data",
 "tagValue": "<data></data>",
 "TagComment": "Adds a machine-readable translation of a given content",
 "TagType": "Styles and Semantics"
},
{
 "tagName": "meta",
 "tagValue": "<meta>",
 "TagComment": "Defines metadata about an HTML document",
 "TagType": "Meta Info"
},
{
 "tagName": "base",
 "tagValue": "<base>",
 "TagComment": "Specifies the base URL/target for all relative URLs in a document",
 "TagType": "Meta Info"
},
{
 "tagName": "scrip",
 "tagValue": "<scrip></scrip>",
 "TagComment": "Defines a client-side script",
 "TagType": "Programming"
},
{
 "tagName": "noscript",
 "tagValue": "<noscript></noscript>",
 "TagComment": "Defines an alternate content for users that do not support client-side scripts",
 "TagType": "Programming"
},
{
 "tagName": "embed",
 "tagValue": "<embed></embed>",
 "TagComment": "Defines a container for an external (non-HTML) application",
 "TagType": "Programming"
},
{
 "tagName": "object",
 "tagValue": "<object></object>",
 "TagComment": "Defines an embedded object",
 "TagType": "Programming"
},
{
 "tagName": "param",
 "tagValue": "<param>",
 "TagComment": "Defines a parameter for an object",
 "TagType": "Programming"
}
];


function buildTable() {
        const tableBody = document.getElementById('tagsTable').getElementsByTagName('tbody')[0];
        tags.forEach((tag, index) => {
            let row = tableBody.insertRow();
            row.onclick = function(event) { chooseTag(index,event); };

            let tagNameCell = row.insertCell(0);
            let tagValueCell = row.insertCell(1);
            let tagTypeCell = row.insertCell(2);
            let tagCommentCell = row.insertCell(3);

            tagNameCell.textContent = tag.tagName;
            tagValueCell.textContent = tag.tagValue;
            tagTypeCell.textContent = tag.TagType;
            tagCommentCell.textContent = tag.TagComment;
        });
    }
    function filterTable(column) {
      let input, filter, table, tr, td, i, txtValue;
      input = document.getElementById("tagsTable").getElementsByTagName("thead")[0].getElementsByTagName("input")[column];
      filter = input.value.toUpperCase();
      table = document.getElementById("tagsTable");
      tr = table.getElementsByTagName("tr");

      for (i = 2; i < tr.length; i++) {
          td = tr[i].getElementsByTagName("td")[column];
          if (td) {
              txtValue = td.textContent || td.innerText;
              if (txtValue.toUpperCase().indexOf(filter) > -1) {
                  tr[i].style.display = "";
              } else {
                  tr[i].style.display = "none";
              }
          }
      }
  }
    function chooseTag(index,event) {
      console.log('in')
      console.log(event)
      let chosenTag = tags[index];
      //alert("Chosen Tag Name: " + chosenTag.tagName + "\nChosen Tag Value: " + chosenTag.tagValue);

      // Get the fieldset attributes
      const fieldset = event.currentTarget.closest('fieldset');
      if (fieldset) {
        const fieldsetId = fieldset.id;
        const fieldsetAction = fieldset.getAttribute('action');
        console.log("Fieldset ID:", fieldsetId);
        console.log("Fieldset Action:", fieldsetAction);
        const el =    
        {
            time: (new Date()).getTime(),
            action:fieldsetAction,
            target_element:fieldsetId.split(';')[1],

          }
          if(fieldsetAction === 'ChangeTag'){
            el.tag_change = chosenTag.tagName
          }
          else {
            el.inserted_element = {type:'tag',tagValue:chosenTag.tagValue,tagName:chosenTag.tagName,id:generateUUID()}
          }
          pushAction(el)
          fieldset.remove()
      }
    }

    window.onload = buildTable;    </script>
</code-builder>





<style>

  .highlight-left-border-red {
      border-left-color: blue; 
  }

  .highlight-red {
  border-color: blue; /* Changes the border color to red */
  box-shadow: 0 0 10px blue; /* Creates a glowing effect around the button */
  transition: all 0.3s ease; /* Smooth transition for the effect */
}


.highlight-left-border-blue {
  border-left-color: red;
}

.highlight-blue {
  border-color: red; /* Changes the border color to red */
  box-shadow: 0 0 10px red; /* Creates a glowing effect around the button */
  transition: all 0.3s ease; /* Smooth transition for the effect */
}

  </style>
<script>
  function mouseOverTree() {
      // Highlight this button in red
      this.classList.add('highlight-red');

      let parentFieldset = this.closest('[data-element="code-tree-tag"]');

      // Highlight the left border of the parent fieldset in red
      if (parentFieldset) {
          parentFieldset.classList.add('highlight-left-border-red');
      }

      // Highlight the left border of sibling fieldsets and their direct child buttons in red
      Array.from(parentFieldset.parentElement.children).forEach(sibling => {
          if (sibling !== parentFieldset && sibling.getAttribute('data-element') === 'code-tree-tag') {
              sibling.classList.add('highlight-left-border-red');
              Array.from(sibling.children).forEach(child => {
                  if (child.tagName === 'BUTTON' && child.getAttribute('data-element') === 'code-tree-show-hide-button') {
                      child.classList.add('highlight-red');
                  }
              });
          }
      });

      // Highlight the left border and buttons of direct child fieldsets of parentFieldset in blue
      Array.from(parentFieldset.children).forEach(child => {
          if (child.tagName === 'FIELDSET' && child.getAttribute('data-element') === 'code-tree-tag') {
              child.classList.add('highlight-left-border-blue');
              Array.from(child.children).forEach(grandchild => {
                  if (grandchild.tagName === 'BUTTON' && grandchild.getAttribute('data-element') === 'code-tree-show-hide-button') {
                      grandchild.classList.add('highlight-blue');
                  }
              });
          }
      });
  }
  function mouseOutTree() {
      let parentFieldset = this.closest('[data-element="code-tree-tag"]');

      // Remove the red and blue highlights
      this.classList.remove('highlight-red');
      if (parentFieldset) {
          parentFieldset.classList.remove('highlight-left-border-red');
      }
      Array.from(parentFieldset.parentElement.children).forEach(sibling => {
          if (sibling !== parentFieldset && sibling.getAttribute('data-element') === 'code-tree-tag') {
              sibling.classList.remove('highlight-left-border-red');
              Array.from(sibling.children).forEach(child => {
                  if (child.tagName === 'BUTTON' && child.getAttribute('data-element') === 'code-tree-show-hide-button') {
                      child.classList.remove('highlight-red');
                  }
              });
          }
      });
      Array.from(parentFieldset.children).forEach(child => {
          if (child.tagName === 'FIELDSET' && child.getAttribute('data-element') === 'code-tree-tag') {
              child.classList.remove('highlight-left-border-blue');
              Array.from(child.children).forEach(grandchild => {
                  if (grandchild.tagName === 'BUTTON' && grandchild.getAttribute('data-element') === 'code-tree-show-hide-button') {
                      grandchild.classList.remove('highlight-blue');
                  }
              });
          }
      });
  }
document.querySelectorAll('button[data-element="code-tree-show-hide-button"]').forEach(button => {
  button.addEventListener('mouseover', mouseOverTree);

  button.addEventListener('mouseout', mouseOutTree);
});
</script>
<!-- dublicate for components-->
<script>
  function mouseOver() {
        // Highlight this button in red
        this.classList.add('highlight-red');
  
        let parentFieldset = this.closest('[data-element="component-tree-tag"]');
  
        // Highlight the left border of the parent fieldset in red
        if (parentFieldset) {
            parentFieldset.classList.add('highlight-left-border-red');
        }
  
        // Highlight the left border of sibling fieldsets and their direct child buttons in red
        Array.from(parentFieldset.parentElement.children).forEach(sibling => {
            if (sibling !== parentFieldset && sibling.getAttribute('data-element') === 'component-tree-tag') {
                sibling.classList.add('highlight-left-border-red');
                Array.from(sibling.children).forEach(child => {
                    if (child.tagName === 'BUTTON' && child.getAttribute('data-element') === 'component-tree-show-hide-button') {
                        child.classList.add('highlight-red');
                    }
                });
            }
        });
  
        // Highlight the left border and buttons of direct child fieldsets of parentFieldset in blue
        Array.from(parentFieldset.children).forEach(child => {
            if (child.tagName === 'FIELDSET' && child.getAttribute('data-element') === 'component-tree-tag') {
                child.classList.add('highlight-left-border-blue');
                Array.from(child.children).forEach(grandchild => {
                    if (grandchild.tagName === 'BUTTON' && grandchild.getAttribute('data-element') === 'component-tree-show-hide-button') {
                        grandchild.classList.add('highlight-blue');
                    }
                });
            }
        });
    }
    function mouseOut() {
        let parentFieldset = this.closest('[data-element="component-tree-tag"]');
  
        // Remove the red and blue highlights
        this.classList.remove('highlight-red');
        if (parentFieldset) {
            parentFieldset.classList.remove('highlight-left-border-red');
        }
        Array.from(parentFieldset.parentElement.children).forEach(sibling => {
            if (sibling !== parentFieldset && sibling.getAttribute('data-element') === 'component-tree-tag') {
                sibling.classList.remove('highlight-left-border-red');
                Array.from(sibling.children).forEach(child => {
                    if (child.tagName === 'BUTTON' && child.getAttribute('data-element') === 'component-tree-show-hide-button') {
                        child.classList.remove('highlight-red');
                    }
                });
            }
        });
        Array.from(parentFieldset.children).forEach(child => {
            if (child.tagName === 'FIELDSET' && child.getAttribute('data-element') === 'component-tree-tag') {
                child.classList.remove('highlight-left-border-blue');
                Array.from(child.children).forEach(grandchild => {
                    if (grandchild.tagName === 'BUTTON' && grandchild.getAttribute('data-element') === 'component-tree-show-hide-button') {
                        grandchild.classList.remove('highlight-blue');
                    }
                });
            }
        });
    
  }
  document.querySelectorAll('button[data-element="component-tree-show-hide-button"]').forEach(button => {
    button.addEventListener('mouseover', mouseOver);
    
    button.addEventListener('mouseout', mouseOut);
    
});
  
  </script>
  

<script>
document.addEventListener('DOMContentLoaded', function() {
    var textarea = document.getElementById('code-tree-inner-html-receive-textarea');
    
    textarea.addEventListener('input', function() {
        // Expand height
        this.style.height = 'auto';
        this.style.height = (this.scrollHeight) + 'px';

        // Expand width
        var mirrorDiv = document.getElementById('mirror-div');
        if (!mirrorDiv) {
            mirrorDiv = document.createElement('div');
            mirrorDiv.id = 'mirror-div';
            document.body.appendChild(mirrorDiv);
        }

        mirrorDiv.style.display = 'inline-block';
        mirrorDiv.textContent = this.value.replace(/\n/g, '<br/>');
        this.style.width = Math.min(this.parentElement.offsetWidth, mirrorDiv.offsetWidth + 10) + 'px'; // 10px for some padding
        mirrorDiv.style.display = 'none';
    });
});
</script>

<!--aside toggle-->
<script>document.getElementById('aside-toggle').addEventListener('click', function() {
  var btn = document.getElementById('aside-toggle');
  var grid = document.getElementById('content-grid');

  // Check the current state and toggle
  if (btn.innerHTML === '‚Üêlog') {
      btn.innerHTML = 'log‚Üí';
      grid.style.gridTemplateColumns = '80% 20%';
  } else {
      btn.innerHTML = '‚Üêlog';
      grid.style.gridTemplateColumns = '100% 0%';
  }
});
</script>

<!--add comment style-->
<style>
  [data-action="code-tree-tag-comment-add"] {
display: inline-block; /* Ensures transform applies */
user-select: none; /* Disables text selection */
}

[data-action="code-tree-tag-comment-add"]:hover {
/* Scale the element up slightly on hover */
transform: scale(1.3); /* Adjust the scale value as needed */
cursor: pointer;
transition: transform 0.2s ease; /* Smooth transition for the scaling effect */
}
.pressed {
/* Define your pressed state styles here */
transform: scale(0.95); /* Example pressed effect */
}
</style>

